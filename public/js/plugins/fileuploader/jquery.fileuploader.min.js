/**
 * Fileuploader
 * Copyright (c) 2018 Innostudio.de
 * Website: http://innostudio.de/fileuploader/
 * Version: 2.1 (26-Nov-2018)
 * Requires: jQuery v1.7.1 or later
 * License: https://innostudio.de/fileuploader/documentation/#license
 */
(function($){'use strict';$.fn.fileuploader=function(q){return this.each(function(t,r){var s=$(r),p=null,o=null,l=null,sl=[],n=$.extend(!0,{},$.fn.fileuploader.defaults,q),f={init:function(){return s.closest('.fileuploader').length||s.wrap('<div class="fileuploader"></div>'),p=s.closest('.fileuploader'),f.set('attrOpts'),f.isSupported()?n.beforeRender&&$.isFunction(n.beforeRender)&&!1===n.beforeRender(p,s)?!1:void(f.redesign(),n.files&&f.files.append(n.files),f.rendered=!0,n.afterRender&&$.isFunction(n.afterRender)?n.afterRender(l,p,o,s):null,!f.disabled&&f.bindUnbindEvents(!0)):(n.onSupportError&&$.isFunction(n.onSupportError)?n.onSupportError(p,s):null,!1)},bindUnbindEvents:function(u){u&&f.bindUnbindEvents(!1),s[u?'on':'off'](f._assets.getAllEvents(),f.onEvent),n.changeInput&&o!==s&&o[u?'on':'off']('click',f.clickHandler),n.dragDrop&&n.dragDrop.container.length&&(n.dragDrop.container[u?'on':'off']('drag dragstart dragend dragover dragenter dragleave drop',function(h){h.preventDefault()}),n.dragDrop.container[u?'on':'off']('drop',f.dragDrop.onDrop),n.dragDrop.container[u?'on':'off']('dragover',f.dragDrop.onDragEnter),n.dragDrop.container[u?'on':'off']('dragleave',f.dragDrop.onDragLeave)),f.isUploadMode()&&n.clipboardPaste&&$(window)[u?'on':'off']('paste',f.clipboard.paste),n.sorter&&n.thumbnails&&n.thumbnails._selectors.sorter&&f.sorter[u?'init':'destroy'](),s.closest('form')[u?'on':'off']('reset',f.reset)},redesign:function(){if(o=s,n.theme&&p.addClass('fileuploader-theme-'+n.theme),n.changeInput){switch((typeof n.changeInput+'').toLowerCase()){case'boolean':o=$('<div class="fileuploader-input"><div class="fileuploader-input-caption"><span>'+f._assets.textParse(n.captions.feedback)+'</span></div><div class="fileuploader-input-button"><span>'+f._assets.textParse(n.captions.button)+'</span></div></div>');break;case'string':' '!=n.changeInput&&(o=$(f._assets.textParse(n.changeInput,n)));break;case'object':o=$(n.changeInput);break;case'function':o=$(n.changeInput(s,p,n,f._assets.textParse));}s.after(o),s.css({position:'absolute','z-index':'-9999',height:'0',width:'0',padding:'0',margin:'0','line-height':'0',outline:'0',border:'0',opacity:'0'})}n.thumbnails&&f.thumbnails.create(),n.dragDrop&&(n.dragDrop='object'==typeof n.dragDrop?n.dragDrop:{container:null},n.dragDrop.container=n.dragDrop.container?$(n.dragDrop.container):o)},clickHandler:function(u){return u.preventDefault(),f.clipboard._timer?void f.clipboard.clean():void s.click()},onEvent:function(u){switch(u.type){case'focus':p?p.addClass('fileuploader-focused'):null;break;case'blur':p?p.removeClass('fileuploader-focused'):null;break;case'change':f.onChange.call(this);}n.listeners&&$.isFunction(n.listeners[u.type])?n.listeners[u.type].call(s,p):null},set:function(u,h){switch(u){case'attrOpts':for(var _,v=['limit','maxSize','fileMaxSize','extensions','changeInput','theme','addMore','listInput','files'],w=0;w<v.length;w++){if(_='data-fileuploader-'+v[w],f._assets.hasAttr(_))switch(v[w]){case'changeInput':case'addMore':case'listInput':n[v[w]]=-1<['true','false'].indexOf(s.attr(_))?'true'==s.attr(_):s.attr(_);break;case'extensions':n[v[w]]=s.attr(_).replace(/ /g,'').split(',');break;case'files':n[v[w]]=JSON.parse(s.attr(_));break;default:n[v[w]]=s.attr(_);}s.removeAttr(_)}(null!=s.attr('disabled')||null!=s.attr('readonly')||0===n.limit)&&(f.disabled=!0),(!n.limit||n.limit&&2<=n.limit)&&(s.attr('multiple','multiple'),n.inputNameBrackets&&'[]'!=s.attr('name').slice(-2)?s.attr('name',s.attr('name')+'[]'):null),!0===n.listInput&&(n.listInput=$('<input type="hidden" name="fileuploader-list-'+s.attr('name').replace('[]','').split('[').pop().replace(']','')+'">').insertBefore(s)),'string'==typeof n.listInput&&0==$(n.listInput).length&&(n.listInput=$('<input type="hidden" name="'+n.listInput+'">').insertBefore(s)),f.set('disabled',f.disabled),!n.fileMaxSize&&n.maxSize&&(n.fileMaxSize=n.maxSize);break;case'disabled':f.disabled=h,p[f.disabled?'addClass':'removeClass']('fileuploader-disabled'),s[f.disabled?'attr':'removeAttr']('disabled','disabled'),f.rendered&&f.bindUnbindEvents(!h);break;case'feedback':h||(h=f._assets.textParse(0<f._itFl.length?n.captions.feedback2:n.captions.feedback,{length:f._itFl.length})),$(!o.is(':file'))?o.find('.fileuploader-input-caption span').html(h):null;break;case'input':var F=f._assets.copyAllAttributes($('<input type="file">'),s,!0);f.bindUnbindEvents(!1),s.after(s=F).remove(),f.bindUnbindEvents(!0);break;case'prevInput':0<sl.length&&(f.bindUnbindEvents(!1),sl[h].remove(),sl.splice(h,1),s=sl[sl.length-1],f.bindUnbindEvents(!0));break;case'nextInput':var F=f._assets.copyAllAttributes($('<input type="file">'),s);f.bindUnbindEvents(!1),0<sl.length&&0==sl[sl.length-1].get(0).files.length?s=sl[sl.length-1]:(-1==sl.indexOf(s)?sl.push(s):null,sl.push(F),s.after(s=F)),f.bindUnbindEvents(!0);break;case'listInput':n.listInput&&n.listInput.val(f.files.list(!0,null,!1,h));}},onChange:function(u,h){var v=s.get(0).files;if(h)if(h.length)v=h;else return f.set('input',''),f.files.clear(),!1;if(f.clipboard._timer&&f.clipboard.clean(),!(f.isDefaultMode()&&(f.reset(),0==v.length))){if(n.beforeSelect&&$.isFunction(n.beforeSelect)&&!1==n.beforeSelect(v,l,p,o,s))return!1;for(var w=0,_=0;_<v.length;_++){var F=v[_],I=f._itFl[f.files.add(F,'choosed')],D=f.files.check(I,v,0==_);if(!0!==D){if(f.files.remove(I,!0),D[2]||(f.isDefaultMode()&&(f.set('input',''),f.reset(),D[3]=!0),D[1]?n.dialogs.alert(D[1],I,l,p,o,s):null),D[3])break;continue}n.thumbnails&&f.thumbnails.item(I),f.isUploadMode()&&f.upload.prepare(I),n.onSelect&&$.isFunction(n.onSelect)?n.onSelect(I,l,p,o,s):null,w++}f.isUploadMode()&&0<w&&f.set('input',''),f.set('feedback',null),f.isAddMoreMode()&&0<w&&f.set('nextInput'),f.set('listInput',null),n.afterSelect&&$.isFunction(n.afterSelect)?n.afterSelect(l,p,o,s):null}},thumbnails:{create:function(){null!=n.thumbnails.beforeShow&&$.isFunction(n.thumbnails.beforeShow)?n.thumbnails.beforeShow(p,o,s):null;var u=$(f._assets.textParse(n.thumbnails.box)).appendTo(n.thumbnails.boxAppendTo?n.thumbnails.boxAppendTo:p);l=u.is(n.thumbnails._selectors.list)?u:u.find(n.thumbnails._selectors.list),n.thumbnails._selectors.popup_open&&l.on('click',n.thumbnails._selectors.popup_open,function(h){h.preventDefault();var v=$(this).closest(n.thumbnails._selectors.item),w=f.files.find(v);w&&w.html.hasClass('file-has-popup')&&f.thumbnails.popup(w)}),f.isUploadMode()&&n.thumbnails._selectors.start&&l.on('click',n.thumbnails._selectors.start,function(h){if(h.preventDefault(),f.locked)return!1;var v=$(this).closest(n.thumbnails._selectors.item),w=f.files.find(v);w&&f.upload.send(w,!0)}),f.isUploadMode()&&n.thumbnails._selectors.retry&&l.on('click',n.thumbnails._selectors.retry,function(h){if(h.preventDefault(),f.locked)return!1;var v=$(this).closest(n.thumbnails._selectors.item),w=f.files.find(v);w&&f.upload.retry(w)}),n.thumbnails._selectors.remove&&l.on('click',n.thumbnails._selectors.remove,function(h){if(h.preventDefault(),f.locked)return!1;var v=$(this).closest(n.thumbnails._selectors.item),w=f.files.find(v),_=function(){f.files.remove(w)};w&&(w.upload&&'successful'!=w.upload.status?f.upload.cancel(w):n.thumbnails.removeConfirmation?n.dialogs.confirm(f._assets.textParse(n.captions.removeConfirmation,w),_):_())})},clear:function(){l&&l.html('')},item:function(u,h){u.icon=f.thumbnails.generateFileIcon(u.format,u.extension),u.image='<div class="fileuploader-item-image"></div>',u.progressBar=f.isUploadMode()?'<div class="fileuploader-progressbar"><div class="bar"></div></div>':'',u.html=$(f._assets.textParse(u.appended&&n.thumbnails.item2?n.thumbnails.item2:n.thumbnails.item,u)),u.progressBar=u.html.find('.fileuploader-progressbar'),u.html.addClass('file-type-'+(u.format?u.format:'no')+' file-ext-'+(u.extension?u.extension:'no')+''),h?h.replaceWith(u.html):u.html[n.thumbnails.itemPrepend?'prependTo':'appendTo'](l),f.thumbnails.renderThumbnail(u),u.renderThumbnail=function(v){v&&u.popup&&u.popup.close&&(u.popup.close(),u.popup={open:u.popup.open}),f.thumbnails.renderThumbnail(u,!0,v)},n.thumbnails.popup&&(u.popup={open:function(){f.thumbnails.popup(u)}}),null!=n.thumbnails.onItemShow&&$.isFunction(n.thumbnails.onItemShow)?n.thumbnails.onItemShow(u,l,p,o,s):null},generateFileIcon:function(u,h){var v='<div style="${style}" class="fileuploader-item-icon${class}"><i>'+(h?h:'')+'</i></div>',w=f._assets.textToColor(h);if(w){var _=f._assets.isBrightColor(w);_&&(v=v.replace('${class}',' is-bright-color')),v=v.replace('${style}','background-color: '+w)}return v.replace('${style}','').replace('${class}','')},renderThumbnail:function(u,h,v){var w=u.html.find('.fileuploader-item-image'),_=u.data&&u.data.readerSkip,F=function(L){var S=$(L);w.removeClass('fileuploader-no-thumbnail fileuploader-loading').html(S),S.is('img')&&S.attr('draggable','false').on('load error',function(E){'error'==E.type&&I(!0),D(),null!=n.thumbnails.onImageLoaded&&$.isFunction(n.thumbnails.onImageLoaded)?n.thumbnails.onImageLoaded(u,l,p,o,s):null}),S.is('canvas')&&(null!=n.thumbnails.onImageLoaded&&$.isFunction(n.thumbnails.onImageLoaded)?n.thumbnails.onImageLoaded(u,l,p,o,s):null)},I=function(L){w.addClass('fileuploader-no-thumbnail'),w.removeClass('fileuploader-loading').html(u.icon),L&&(null!=n.thumbnails.onImageLoaded&&$.isFunction(n.thumbnails.onImageLoaded)?n.thumbnails.onImageLoaded(u,l,p,o,s):null)},D=function(){var L=0;if(u&&-1<f._pfrL.indexOf(u))for(f._pfrL.splice(f._pfrL.indexOf(u),1);L<f._pfrL.length;){if(-1<f._itFl.indexOf(f._pfrL[L])){f.thumbnails.renderThumbnail(f._pfrL[L],!0);break}else f._pfrL.splice(L,1);L++}};if(!w.length)return void D();if(u.image=w.html('').addClass('fileuploader-loading'),(-1<['image','video','audio','astext'].indexOf(u.format)||u.data.thumbnail)&&f.isFileReaderSupported()&&!_&&(u.appended||n.thumbnails.startImageRenderer||h)){if(n.thumbnails.synchronImages&&(-1!=f._pfrL.indexOf(u)||h?null:f._pfrL.push(u),1<f._pfrL.length&&!h))return;var C=function(L,S){var E=L.nodeName&&'img'==L.nodeName.toLocaleLowerCase(),T=E?L.src:L;if(n.thumbnails.canvasImage){var O=document.createElement('canvas'),z=E?L:new Image,P=function(){f.editor.resize(z,O,n.thumbnails.canvasImage.width?n.thumbnails.canvasImage.width:w.width(),n.thumbnails.canvasImage.height?n.thumbnails.canvasImage.height:w.height(),!1,!0),f._assets.isBlankCanvas(O)?I():F(O),D()},R=function(){I(!0),D(),z=null};if('image'==u.format&&S&&u.reader.node)return z=u.reader.node,P();if(!T)return R();if(E)return P.call(L);z.onload=P,z.onerror=R,u.data&&u.data.readerCrossOrigin&&z.setAttribute('crossOrigin',u.data.readerCrossOrigin),z.src=T}else F(E?L:'<img src="'+T+'">')};return'string'==typeof v||'object'==typeof v?C(v):f.files.read(u,function(){u.reader.node&&n.thumbnails.popup&&u.html.addClass('file-has-popup'),u.reader.node&&(u.reader.frame||'img'==u.reader.node.nodeName.toLowerCase())?C(u.reader.frame||u.reader.src,!0):(I('image'==u.format),D())},null,v,!0)}I()},popup:function(u,h){if(!f.locked&&n.thumbnails.popup&&n.thumbnails._selectors.popup){var v=$(n.thumbnails.popup.container),w=v.find('.fileuploader-popup'),F=function(){var I=u.popup.html||$(f._assets.textParse(n.thumbnails.popup.template,u)),D=u.popup.html!==I,C=function(L){var S=L.which||L.keyCode;27==S&&u.popup&&u.popup.close&&u.popup.close(),(37==S||39==S)&&n.thumbnails.popup.arrows&&u.popup.move(37==S?'prev':'next')};w.removeClass('loading'),w.children(n.thumbnails._selectors.popup).length&&($.each(f._itFl,function(L,S){S!=u&&S.popup&&S.popup.close&&S.popup.close(h)}),w.find(n.thumbnails._selectors.popup).remove()),I.show().appendTo(w),u.popup.html=I,u.popup.move=function(L){var S=f._itFl.indexOf(u),E=null,T=!1;if('prev'==L)for(var z,O=S;0<=O;O--){if(z=f._itFl[O],z!=u&&z.popup&&z.html.hasClass('file-has-popup')){E=z;break}0!=O||E||T||!n.thumbnails.popup.loop||(O=f._itFl.length,T=!0)}else for(var z,O=S;O<f._itFl.length;O++){if(z=f._itFl[O],z!=u&&z.popup&&z.html.hasClass('file-has-popup')){E=z;break}O+1!=f._itFl.length||E||T||!n.thumbnails.popup.loop||(O=-1,T=!0)}E&&f.thumbnails.popup(E,!0)},u.popup.close=function(L){u.reader.node&&(u.reader.node.pause?u.reader.node.pause():null),$(window).off('keyup',C),v.css({overflow:'',width:''}),u.popup.editor&&u.popup.editor.cropper&&u.popup.editor.cropper.hide(),u.popup.html&&n.thumbnails.popup.onHide&&$.isFunction(n.thumbnails.popup.onHide)?n.thumbnails.popup.onHide(u,l,p,o,s):u.popup.html?u.popup.html.remove():null,L||w.fadeOut(400,function(){w.remove()}),delete u.popup.close},u.reader.node?(D&&I.find('.fileuploader-popup-node').html(u.reader.node),u.reader.node.controls=!0,u.reader.node.currentTime=0,u.reader.node.play?u.reader.node.play():null):I.find('.fileuploader-popup-node').html('<div class="fileuploader-popup-file-icon">'+u.icon+'</div>'),$(window).on('keyup',C),v.css({overflow:'hidden',width:v.innerWidth()}),u.popup.html.find('[data-action="prev"], [data-action="next"]').removeAttr('style'),u.popup.html[1!=f._itFl.length&&n.thumbnails.popup.arrows?'addClass':'removeClass']('fileuploader-popup-has-arrows'),n.thumbnails.popup.loop||(0==f._itFl.indexOf(u)&&u.popup.html.find('[data-action="prev"]').hide(),f._itFl.indexOf(u)==f._itFl.length-1&&u.popup.html.find('[data-action="next"]').hide()),u.editor&&u.popup.editor&&u.popup.editor.hasChanges?(u.popup.editor&&u.popup.editor.rotation&&f.editor.rotate(u,u.editor.rotation||0,!0),u.popup.editor&&u.popup.editor.cropper&&(u.popup.editor.cropper.hide(!0),setTimeout(function(){f.editor.crop(u,u.editor.crop?$.extend({},u.editor.crop):u.popup.editor.cropper.setDefaultData())},100))):u.popup.editor={},n.thumbnails.popup.onShow&&$.isFunction(n.thumbnails.popup.onShow)?n.thumbnails.popup.onShow(u,l,p,o,s):null};0==w.length&&(w=$('<div class="fileuploader-popup"></div>').appendTo(v)),w.fadeIn(400).addClass('loading'),-1<['image','video','audio','astext'].indexOf(u.format)&&!u.popup.html?f.files.read(u,F):F()}}},editor:{rotate:function(u,h,v){var w=u.popup&&'undefined'!=typeof u.popup.html;if(!w){var _=u.editor.rotation||0;return u.editor.rotation=h?h:_+90}if(!u.popup.editor.isAnimating){u.popup.editor.isAnimating=!0;var F=u.popup.html,I=F.find('.fileuploader-popup-node'),D=I.find('> img'),_=u.popup.editor.rotation||0,C=u.popup.editor.scale||1;u.popup.editor.cropper&&u.popup.editor.cropper.$template.hide(),u.popup.editor.rotation=v?h:_+90,u.popup.editor.scale=(I.height()/D[-1<[90,270].indexOf(u.popup.editor.rotation)?'width':'height']()).toFixed(3),D.height()*u.popup.editor.scale>I.width()&&-1<[90,270].indexOf(u.popup.editor.rotation)&&(u.popup.editor.scale=I.width()/D.height()),1<u.popup.editor.scale&&(u.popup.editor.scale=1),$({rotation:_,scale:C}).animate({rotation:u.popup.editor.rotation,scale:u.popup.editor.scale},{duration:v?1:300,easing:'swing',step:function(S,E){var T=D.css('-webkit-transform')||D.css('-moz-transform')||D.css('transform')||'none',O=0,z=1,P=E.prop;if('none'!==T){var R=T.split('(')[1].split(')')[0].split(','),A=R[0],U=R[1];O='rotation'==P?S:Math.round(Math.atan2(U,A)*(180/Math.PI)),z='scale'==P?S:Math.round(10*Math.sqrt(A*A+U*U))/10}D.css({'-webkit-transform':'rotate('+O+'deg) scale('+z+')','-moz-transform':'rotate('+O+'deg) scale('+z+')',transform:'rotate('+O+'deg) scale('+z+')'})},always:function(){delete u.popup.editor.isAnimating,u.popup.editor.cropper&&!v&&(u.popup.editor.cropper.setDefaultData(),u.popup.editor.cropper.init('rotation'))}}),360<=u.popup.editor.rotation&&(u.popup.editor.rotation=0),u.popup.editor.rotation!=u.editor.rotation&&(u.popup.editor.hasChanges=!0)}},crop:function(u,h){var v=u.popup&&'undefined'!=typeof u.popup.html;if(!v)return u.editor.crop=h||u.editor.crop;if(!u.popup.editor.cropper){var _=u.popup.html,F=_.find('.fileuploader-popup-node > img'),I=$('<div class="fileuploader-cropper"><div class="fileuploader-cropper-area"><div class="point point-a"></div><div class="point point-b"></div><div class="point point-c"></div><div class="point point-d"></div><div class="point point-e"></div><div class="point point-f"></div><div class="point point-g"></div><div class="point point-h"></div><div class="area-move"></div><div class="area-image"></div><div class="area-info"></div></div></div>'),D=I.find('.fileuploader-cropper-area');u.popup.editor.cropper={$imageEl:F,$template:I,$editor:D,isCropping:!1,crop:h||null,init:function(C){var L=u.popup.editor.cropper,S=L.$imageEl.position(),E=L.$imageEl[0].getBoundingClientRect().width,T=L.$imageEl[0].getBoundingClientRect().height,O=u.popup.editor.rotation&&-1<[90,270].indexOf(u.popup.editor.rotation),z=O?u.popup.editor.scale:1;return L.hide(),L.crop||L.setDefaultData(),0==E||0==T?L.hide(!0):void(!L.isCropping&&(L.$imageEl.clone().appendTo(L.$template.find('.area-image')),L.$imageEl.parent().append(I)),L.$template.hide().css({left:S.left,top:S.top,width:E,height:T}).fadeIn(150),L.$editor.hide(),clearTimeout(L._editorAnimationTimeout),L._editorAnimationTimeout=setTimeout(function(){if(delete L._editorAnimationTimeout,L.$editor.fadeIn(250),u.editor.crop&&$.isPlainObject(C)&&(L.resize(),L.crop.left=L.crop.left*L.crop.cfWidth*z,L.crop.width=L.crop.width*L.crop.cfWidth*z,L.crop.top=L.crop.top*L.crop.cfHeight*z,L.crop.height=L.crop.height*L.crop.cfHeight*z),(!u.editor.crop||'rotation'==C)&&n.editor.cropper&&n.editor.cropper.ratio&&'resize'!=C){var P=n.editor.cropper.ratio,R=f._assets.ratioToPx(L.crop.width,L.crop.height,P);R&&(L.crop.width=Math.min(L.crop.width,R[0]),L.crop.left=(L.$template.width()-L.crop.width)/2,L.crop.height=Math.min(L.crop.height,R[1]),L.crop.top=(L.$template.height()-L.crop.height)/2)}L.drawPlaceHolder(L.crop)},400),!L.isCropping&&L.$template.on('drop dragend dragleave dragover dragenter dragstart touchstart touchmove touchend touchcancel',function(P){P.preventDefault()}),n.editor.cropper&&n.editor.cropper.showGrid&&L.$editor.addClass('has-grid'),L.$imageEl.attr('draggable','false'),L.$template.on('mousedown touchstart',L.mousedown),$(window).on('resize',L.resize),L.isCropping=!0,u.popup.editor.hasChanges=!0)},setDefaultData:function(){var C=u.popup.editor.cropper,L=C.$imageEl,S=L.width(),E=L.height(),T=u.popup.editor.rotation&&-1<[90,270].indexOf(u.popup.editor.rotation),O=u.popup.editor.scale||1;return C.crop={left:0,top:0,width:T?E*O:S,height:T?S*O:E,cfWidth:S/C.$imageEl.prop('naturalWidth'),cfHeight:E/C.$imageEl.prop('naturalHeight')},null},hide:function(C){var L=u.popup.editor.cropper;C&&(L.$template.hide(),L.$editor.hide()),L.$imageEl.attr('draggable',''),L.$template.off('mousedown touchstart',L.mousedown),$(window).off('resize',L.resize)},resize:function(C){var L=u.popup.editor.cropper,S=L.$imageEl;0<S.width()&&(C?(L.$template.hide(),clearTimeout(L._resizeTimeout),L._resizeTimeout=setTimeout(function(){delete L._resizeTimeout;var E=S.width()/S.prop('naturalWidth'),T=S.height()/S.prop('naturalHeight');L.crop.left=L.crop.left/L.crop.cfWidth*E,L.crop.width=L.crop.width/L.crop.cfWidth*E,L.crop.top=L.crop.top/L.crop.cfHeight*T,L.crop.height=L.crop.height/L.crop.cfHeight*T,L.crop.cfWidth=E,L.crop.cfHeight=T,L.init('resize')},500)):(L.crop.cfWidth=S.width()/S.prop('naturalWidth'),L.crop.cfHeight=S.height()/S.prop('naturalHeight')))},drawPlaceHolder:function(C){var L=u.popup.editor.cropper,S=u.popup.editor.rotation||0,E=u.popup.editor.scale||1,T=[0,0];C&&(C=$.extend({},C),S&&(T=[180==S||270==S?-100:0,90==S||180==S?-100:0]),L.$editor.css(C),L.setAreaInfo(),L.$editor.find('.area-image img').removeAttr('style').css({width:L.$imageEl.width(),height:L.$imageEl.height(),left:-1*L.$editor.position().left,top:-1*L.$editor.position().top,'-webkit-transform':'rotate('+S+'deg) scale('+E+') translateX('+T[0]+'%) translateY('+T[1]+'%)','-moz-transform':'rotate('+S+'deg) scale('+E+') translateX('+T[0]+'%) translateY('+T[1]+'%)',transform:'rotate('+S+'deg) scale('+E+') translateX('+T[0]+'%) translateY('+T[1]+'%)'}))},setAreaInfo:function(C){var L=u.popup.editor.cropper,S=u.popup.editor.scale||1;L.$editor.find('.area-info').html((L.isResizing||'size'==C?['W: '+Math.round(L.crop.width/L.crop.cfWidth/S)+'px',' ','H: '+Math.round(L.crop.height/L.crop.cfHeight/S)+'px']:['X: '+Math.round(L.crop.left/L.crop.cfWidth/S)+'px',' ','Y: '+Math.round(L.crop.top/L.crop.cfHeight/S)+'px']).join(''))},mousedown:function(C){var L=C.originalEvent.touches&&C.originalEvent.touches[0]?'touchstart':'mousedown',S=$(C.target),E=u.popup.editor.cropper,T={x:('mousedown'==L?C.pageX:C.originalEvent.touches[0].pageX)-E.$template.offset().left,y:('mousedown'==L?C.pageY:C.originalEvent.touches[0].pageY)-E.$template.offset().top},O=function(){E.pointData={el:S,x:T.x,y:T.y,xEditor:T.x-E.crop.left,yEditor:T.y-E.crop.top,left:E.crop.left,top:E.crop.top,width:E.crop.width,height:E.crop.height},S.is('.area-move')&&(E.isMoving=!0),S.is('.point')&&(E.isResizing=!0),(E.isMoving||E.isResizing)&&(E.setAreaInfo('size'),E.$editor.addClass('moving show-info'),$('body').css({'-webkit-user-select':'none','-moz-user-select':'none','-ms-user-select':'none','user-select':'none'}),$(window).on('mousemove touchmove',E.mousemove))};'mousedown'==L&&O(),'touchstart'==L&&(E.isTouchLongPress=!0,setTimeout(function(){E.isTouchLongPress&&(delete E.isTouchLongPress,O())},500)),$(window).on('mouseup touchend',E.mouseup)},mousemove:function(C){var L=C.originalEvent.touches&&C.originalEvent.touches[0]?'touchstart':'mousedown',S=$(C.target),E=u.popup.editor.cropper,T={x:('mousedown'==L?C.pageX:C.originalEvent.touches[0].pageX)-E.$template.offset().left,y:('mousedown'==L?C.pageY:C.originalEvent.touches[0].pageY)-E.$template.offset().top};if(E.isMoving){var O=T.x-E.pointData.xEditor,z=T.y-E.pointData.yEditor;O+E.crop.width>E.$template.width()&&(O=E.$template.width()-E.crop.width),0>O&&(O=0),z+E.crop.height>E.$template.height()&&(z=E.$template.height()-E.crop.height),0>z&&(z=0),E.crop.left=O,E.crop.top=z}if(E.isResizing){var B,P=E.pointData.el.attr('class').substr('point point-'.length),R=E.crop.left+E.crop.width,A=E.crop.top+E.crop.height,U=(n.editor.cropper&&n.editor.cropper.minWidth||0)*E.crop.cfWidth,H=(n.editor.cropper&&n.editor.cropper.minHeight||0)*E.crop.cfHeight,M=n.editor.cropper?n.editor.cropper.ratio:null;if(U>E.$template.width()&&(U=E.$template.width()),H>E.$template.height()&&(H=E.$template.height()),('a'==P||'b'==P||'c'==P)&&!B&&(E.crop.top=T.y,0>E.crop.top&&(E.crop.top=0),E.crop.height=A-E.crop.top,E.crop.top>E.crop.top+E.crop.height&&(E.crop.top=A,E.crop.height=0),E.crop.height<H&&(E.crop.top=A-H,E.crop.height=H),B=M?f._assets.ratioToPx(E.crop.width,E.crop.height,M):null,B&&(E.crop.width=B[0],('a'==P||'b'==P)&&(E.crop.left=Math.max(0,E.pointData.left+(E.pointData.width-E.crop.width)/('b'==P?2:1))),E.crop.left+E.crop.width>E.$template.width()))){var W=E.$template.width()-E.crop.left;E.crop.width=W,E.crop.height=W/B[2]*B[3],E.crop.top=A-E.crop.height}if(('e'==P||'f'==P||'g'==P)&&!B&&(E.crop.height=T.y-E.crop.top,E.crop.height+E.crop.top>E.$template.height()&&(E.crop.height=E.$template.height()-E.crop.top),E.crop.height<H&&(E.crop.height=H),B=M?f._assets.ratioToPx(E.crop.width,E.crop.height,M):null,B&&(E.crop.width=B[0],('f'==P||'g'==P)&&(E.crop.left=Math.max(0,E.pointData.left+(E.pointData.width-E.crop.width)/('f'==P?2:1))),E.crop.left+E.crop.width>E.$template.width()))){var W=E.$template.width()-E.crop.left;E.crop.width=W,E.crop.height=W/B[2]*B[3]}if(('c'==P||'d'==P||'e'==P)&&!B&&(E.crop.width=T.x-E.crop.left,E.crop.width+E.crop.left>E.$template.width()&&(E.crop.width=E.$template.width()-E.crop.left),E.crop.width<U&&(E.crop.width=U),B=M?f._assets.ratioToPx(E.crop.width,E.crop.height,M):null,B&&(E.crop.height=B[1],('c'==P||'d'==P)&&(E.crop.top=Math.max(0,E.pointData.top+(E.pointData.height-E.crop.height)/('d'==P?2:1))),E.crop.top+E.crop.height>E.$template.height()))){var Y=E.$template.height()-E.crop.top;E.crop.height=Y,E.crop.width=Y/B[3]*B[2]}if(('a'==P||'g'==P||'h'==P)&&!B&&(E.crop.left=T.x,E.crop.left>E.$template.width()&&(E.crop.left=E.$template.width()),0>E.crop.left&&(E.crop.left=0),E.crop.width=R-E.crop.left,E.crop.left>E.crop.left+E.crop.width&&(E.crop.left=R,E.crop.width=0),E.crop.width<U&&(E.crop.left=R-U,E.crop.width=U),B=M?f._assets.ratioToPx(E.crop.width,E.crop.height,M):null,B&&(E.crop.height=B[1],('a'==P||'h'==P)&&(E.crop.top=Math.max(0,E.pointData.top+(E.pointData.height-E.crop.height)/('h'==P?2:1))),E.crop.top+E.crop.height>E.$template.height()))){var Y=E.$template.height()-E.crop.top;E.crop.height=Y,E.crop.width=Y/B[3]*B[2],E.crop.left=R-E.crop.width}}E.drawPlaceHolder(E.crop)},mouseup:function(){var L=u.popup.editor.cropper;(0==L.$editor.width()||0==L.$editor.height())&&L.init(L.setDefaultData()),delete L.isTouchLongPress,delete L.isMoving,delete L.isResizing,L.$editor.removeClass('moving show-info'),$('body').css({'-webkit-user-select':'','-moz-user-select':'','-ms-user-select':'','user-select':''}),$(window).off('mousemove touchmove',L.mousemove),$(window).off('mouseup touchend',L.mouseup)}},u.popup.editor.cropper.init()}else h&&(u.popup.editor.cropper.crop=h),u.popup.editor.cropper.init(h)},resize:function(u,h,v,w,_,F){var I=h.getContext('2d'),v=!v&&w?w*u.width/u.height:v,w=!w&&v?v*u.height/u.width:w,D=u.width/u.height,C=1<=D?v:w*D,L=1>D?w:v/D;F&&C<v&&(L*=v/C,C=v),F&&L<w&&(C*=w/L,L=w);var S=Math.min(Math.ceil(Math.log(u.width/C)/Math.log(2)),12);if(h.width=C,h.height=L,u.width<h.width||u.height<h.height||2>S){F||(h.width=Math.min(u.width,h.width),h.height=Math.min(u.height,h.height));var E=u.width<h.width?(h.width-u.width)/2:0,T=u.height<h.height?(h.height-u.height)/2:0;_||(I.fillStyle='#fff',I.fillRect(0,0,h.width,h.height)),I.drawImage(u,E,T,Math.min(u.width,h.width),Math.min(u.height,h.height))}else{var O=document.createElement('canvas'),z=O.getContext('2d'),P=2;for(O.width=u.width/P,O.height=u.height/P,z.fillStyle='#fff',z.fillRect(0,0,O.width,O.height),z.drawImage(u,0,0,u.width/2,u.height/2);2<S;){var R=P+2,A=u.width/P,U=u.height/P;A>O.width&&(A=O.width),U>O.height&&(U=O.height),z.drawImage(O,0,0,A,U,0,0,u.width/R,u.height/R),P=R,S--}var A=u.width/P,U=u.height/P;A>O.width&&(A=O.width),U>O.height&&(U=O.height),I.drawImage(O,0,0,A,U,0,0,C,L),O=z=null}I=null},save:function(u,h,v,w,_){var F=u.popup&&'undefined'!=typeof u.popup.html;if(F){if(!u.popup.editor.hasChanges)return;var I=u.popup.editor.scale||1;u.editor.rotation=u.popup.editor.rotation||0,u.popup.editor.cropper&&(u.editor.crop=u.popup.editor.cropper.crop,u.editor.crop.width=u.editor.crop.width/u.popup.editor.cropper.crop.cfWidth/I,u.editor.crop.left=u.editor.crop.left/u.popup.editor.cropper.crop.cfWidth/I,u.editor.crop.height=u.editor.crop.height/u.popup.editor.cropper.crop.cfHeight/I,u.editor.crop.top=u.editor.crop.top/u.popup.editor.cropper.crop.cfHeight/I)}var D=document.createElement('canvas'),C=D.getContext('2d'),L=u.reader.node,S=[0,180];if(D.width=L.naturalWidth,D.height=L.naturalHeight,C.drawImage(L,0,0),'undefined'!=typeof u.editor.rotation){u.editor.rotation=u.editor.rotation||0,D.width=-1<S.indexOf(u.editor.rotation)?L.naturalWidth:L.naturalHeight,D.height=-1<S.indexOf(u.editor.rotation)?L.naturalHeight:L.naturalWidth;var E=u.editor.rotation*Math.PI/180,T=0.5*D.width,O=0.5*D.height;C.clearRect(0,0,D.width,D.height),C.translate(T,O),C.rotate(E),C.translate(0.5*-L.naturalWidth,0.5*-L.naturalHeight),C.drawImage(L,0,0),C.setTransform(1,0,0,1,0,0)}if(u.editor.crop){var z=C.getImageData(u.editor.crop.left,u.editor.crop.top,u.editor.crop.width,u.editor.crop.height);D.width=u.editor.crop.width,D.height=u.editor.crop.height,C.putImageData(z,0,0)}var P=v||u.type||'image/jpeg',R=n.editor.quality||90,A=D.toDataURL(P,R/100),U=function(M,B){var W=h?f._assets.dataURItoBlob(M,P):M;F&&!_?f.thumbnails.renderThumbnail(u,!0,B||M):null,w?w(W,u,l,p,o,s):null,null!=n.editor.onSave&&'function'==typeof n.editor.onSave?n.editor.onSave(W,u,l,p,o,s):null,f.set('listInput',null)};if(n.editor.maxWidth||n.editor.maxHeight){var H=new Image;H.src=A,H.onload=function(){var M=document.createElement('canvas');f.editor.resize(H,M,n.editor.maxWidth,n.editor.maxHeight,!0,!1),A=M.toDataURL(P,R/100),D=C=M=null,U(A,H)}}else D=C=null,U(A)}},sorter:{init:function(){p.on('mousedown touchstart',n.thumbnails._selectors.sorter,f.sorter.mousedown)},destroy:function(){p.off('mousedown touchstart',n.thumbnails._selectors.sorter,f.sorter.mousedown)},prevent:function(u){return!0===u?'click drop dragend dragleave dragover dragenter dragstart touchstart touchmove touchend touchcancel':void u.preventDefault()},mousedown:function(u){var h=u.originalEvent.touches&&u.originalEvent.touches[0]?'touchstart':'mousedown',v=$(u.target),w=v.closest(n.thumbnails._selectors.item),_=f.files.find(w),F={x:'mousedown'!=h&&w.length?u.originalEvent.touches[0].pageX:u.pageX,y:'mousedown'!=h&&w.length?u.originalEvent.touches[0].pageY:u.pageY},I=function(){f.sorter.sort={el:v,item:_,items:l.find(n.thumbnails._selectors.item),x:F.x,y:F.y,xItem:F.x-w.offset().left,yItem:F.y-w.offset().top,left:w.position().left,top:w.position().top,width:w.outerWidth(),height:w.outerHeight(),placeholder:n.sorter.placeholder?$(n.sorter.placeholder):_.html.clone().addClass('fileuploader-sorter-placeholder').html('')},$('body').css({'-webkit-user-select':'none','-moz-user-select':'none','-ms-user-select':'none','user-select':'none'}),$(window).on('mousemove touchmove',f.sorter.mousemove)};f.sorter.sort&&f.sorter.mouseup(),!_||n.sorter.selectorExclude&&(v.is(n.sorter.selectorExclude)||v.closest(n.sorter.selectorExclude).length)||(p.on(f.sorter.prevent(!0),n.thumbnails._selectors.sorter,f.sorter.prevent),'mousedown'==h&&I(),'touchstart'==h&&(f.sorter.isTouchLongPress=!0,setTimeout(function(){f.sorter.isTouchLongPress&&(delete f.sorter.isTouchLongPress,I())},500)),$(window).on('mouseup touchend',f.sorter.mouseup))},findItemAtPos:function(u){var h=f.sorter.sort,v=h.items.not(h.item.html),w=null;return v.each(function(_,F){var I=$(F);if(u.x>I.offset().left&&u.x<I.offset().left+I.outerWidth()&&u.y>I.offset().top&&u.y<I.offset().top+I.outerHeight())return w=I,!1}),w},mousemove:function(u){var h=u.originalEvent.touches&&u.originalEvent.touches[0]?'touchstart':'mousedown',v=f.sorter.sort,w=v.item,_=l.find(n.thumbnails._selectors.item),F=$(n.sorter.scrollContainer||window),I={left:F.scrollLeft(),top:F.scrollTop()},D={x:'mousedown'==h?u.pageX:u.originalEvent.touches[0].pageX,y:'mousedown'==h?u.pageY:u.originalEvent.touches[0].pageY},C=D.x-v.xItem-I.left,L=D.y-v.yItem-I.top;C+v.xItem>F.width()&&(C=F.width()-v.xItem),C<0-v.xItem&&(C=0-v.xItem),L+v.yItem>F.height()&&(L=F.height()-v.yItem),L<0-v.yItem&&(L=0-v.yItem),w.html.addClass('sorting').css({position:'fixed',left:C,top:L,width:f.sorter.sort.width,height:f.sorter.sort.height}),l.find(v.placeholder).length||w.html.after(v.placeholder),v.placeholder.css({width:f.sorter.sort.width,height:f.sorter.sort.height});var S=f.sorter.findItemAtPos({x:C+v.xItem+I.left,y:L+v.yItem+I.top});if(S){var E=v.placeholder.offset().left!=S.offset().left,T=v.placeholder.offset().top!=S.offset().top;if(f.sorter.sort.lastHover&&f.sorter.sort.lastHover.el==S[0]){if(T&&'before'==f.sorter.sort.lastHover.direction&&D.y<f.sorter.sort.lastHover.y)return;if(T&&'after'==f.sorter.sort.lastHover.direction&&D.y>f.sorter.sort.lastHover.y)return;if(E&&'before'==f.sorter.sort.lastHover.direction&&D.x<f.sorter.sort.lastHover.x)return;if(E&&'after'==f.sorter.sort.lastHover.direction&&D.x>f.sorter.sort.lastHover.x)return}var O=_.index(w.html),z=_.index(S),P=O>z?'before':'after';S[P](v.placeholder),S[P](w.html),f.sorter.sort.lastHover={el:S[0],x:D.x,y:D.y,direction:P},F.scrollLeft(I.left),F.scrollTop(I.top)}},mouseup:function(){var u=f.sorter.sort,h=u.item;$('body').css({'-webkit-user-select':'','-moz-user-select':'','-ms-user-select':'','user-select':''}),h.html.removeClass('sorting').css({position:'',left:'',top:'',width:'',height:''}),u.placeholder.remove(),delete f.sorter.sort,p.off(f.sorter.prevent(!0),n.thumbnails._selectors.sorter,f.sorter.prevent),$(window).off('mousemove touchmove',f.sorter.mousemove),$(window).off('mouseup touchend',f.sorter.mouseup),f.sorter.save()},save:function(u){var h=0,v=[],w=f.rendered&&u;$.each(u?f._itFl:l.children(),function(_,F){var I=F.file?F:f.files.find($(F));if(I){if(I.upload&&!I.uploaded)return w=!1,!1;f.rendered&&I.index!=h&&(w=!0),I.index=h,v.push(I),h++}}),w&&v.length==f._itFl.length&&(f._itFl=v),u||f.set('listInput','ignoreSorter'),w&&null!=n.sorter.onSort&&'function'==typeof n.sorter.onSort?n.sorter.onSort(v,l,p,o,s):null}},upload:{prepare:function(u,h){u.upload={url:n.upload.url,data:$.extend({},n.upload.data),formData:new FormData,type:n.upload.type||'POST',enctype:n.upload.enctype||'multipart/form-data',cache:!1,contentType:!1,processData:!1,status:null,send:function(){f.upload.send(u,!0)},cancel:function(v){f.upload.cancel(u,v)},retry:function(){f.upload.retry(u)}},u.upload.formData.append(s.attr('name'),u.file,!!u.name&&u.name),(n.upload.start||h)&&f.upload.send(u,h)},send:function(u,h){if(u.upload){var v=function(L){u.html.removeClass('upload-pending upload-loading upload-cancelled upload-failed upload-success').addClass('upload-'+(L||u.upload.status))},w=function(){var L=0;if(0<f._pfuL.length)for(-1<f._pfuL.indexOf(u)?f._pfuL.splice(f._pfuL.indexOf(u),1):null;L<f._pfuL.length;){if(-1<f._itFl.indexOf(f._pfuL[L])&&f._pfuL[L].upload&&!f._pfuL[L].upload.$ajax){f.upload.send(f._pfuL[L],!0);break}else f._pfuL.splice(L,1);L++}};if(n.upload.synchron&&!u.upload.chunk)if(u.upload.status='pending',u.html&&v(),h)-1<f._pfuL.indexOf(u)?f._pfuL.splice(f._pfuL.indexOf(u),1):null;else if(-1==f._pfuL.indexOf(u)?f._pfuL.push(u):null,1<f._pfuL.length)return;if(n.upload.chunk&&u.file.slice){var _=1e6*n.upload.chunk,F=Math.ceil(u.size/_,_);if(1<F&&!u.upload.chunk&&(u.upload.chunk={name:u.name,size:u.file.size,type:u.file.type,chunkSize:_,temp_name:u.name,loaded:0,total:F,i:-1}),u.upload.chunk)if(u.upload.chunk.i++,delete u.upload.chunk.isFirst,delete u.upload.chunk.isLast,0==u.upload.chunk.i&&(u.upload.chunk.isFirst=!0),u.upload.chunk.i==u.upload.chunk.total-1&&(u.upload.chunk.isLast=!0),u.upload.chunk.i<=u.upload.chunk.total-1){var I=u.upload.chunk.i*u.upload.chunk.chunkSize,D=u.file.slice(I,I+u.upload.chunk.chunkSize);u.upload.data=n.upload.data||{},u.upload.formData=new FormData,u.upload.formData.append(s.attr('name'),D),u.upload.data._chunkedd=JSON.stringify(u.upload.chunk)}else delete u.upload.chunk}if(n.upload.beforeSend&&$.isFunction(n.upload.beforeSend)&&!1===n.upload.beforeSend(u,l,p,o,s))return delete u.upload.chunk,v(),void w();if(p.addClass('fileuploader-is-uploading'),u.upload.$ajax&&u.upload.$ajax.abort(),delete u.upload.$ajax,delete u.upload.send,u.upload.status='loading',u.html&&(n.thumbnails._selectors.start&&u.html.find(n.thumbnails._selectors.start).remove(),v()),u.upload.data)for(var C in u.upload.data)u.upload.formData.append(C,u.upload.data[C]);u.upload.data=u.upload.formData,u.upload.xhr=function(){var L=$.ajaxSettings.xhr(),S=u.upload.chunk&&u.upload.chunk.xhrStartedAt?u.upload.chunk.xhrStartedAt:new Date;return L.upload&&L.upload.addEventListener('progress',function(E){u.upload.$ajax&&(u.upload.$ajax.total=u.upload.chunk?u.upload.chunk.size:E.total,u.upload.$ajax.xhrStartedAt=S),f.upload.progressHandling(E,u,S)},!1),L},u.upload.complete=function(L,S){if(u.upload.chunk&&!u.upload.chunk.isLast&&'success'==S)return f.upload.send(u);w();var E=!0;$.each(f._itFl,function(T,O){O.upload&&O.upload.$ajax&&(E=!1)}),E&&(p.removeClass('fileuploader-is-uploading'),null!=n.upload.onComplete&&'function'==typeof n.upload.onComplete?n.upload.onComplete(l,p,o,s,L,S):null)},u.upload.success=function(L,S,E){if(u.upload.chunk&&!u.upload.chunk.isLast){try{var T=JSON.parse(L);u.upload.chunk.temp_name=T.fileuploader.temp_name}catch(O){}return}delete u.upload.chunk,f.upload.progressHandling(null,u,u.upload.$ajax.xhrStartedAt,!0),u.uploaded=!0,delete u.upload,u.upload={status:'successful',resend:function(){f.upload.retry(u)}},u.html&&v(),null!=n.upload.onSuccess&&$.isFunction(n.upload.onSuccess)?n.upload.onSuccess(L,u,l,p,o,s,S,E):null,f.set('listInput',null)},u.upload.error=function(L,S,E){u.uploaded=!1,u.upload.status='cancelled'==u.upload.status?u.upload.status:'failed',delete u.upload.$ajax,u.html&&v(),null!=n.upload.onError&&$.isFunction(n.upload.onError)?n.upload.onError(u,l,p,o,s,L,S,E):null},u.upload.$ajax=$.ajax(u.upload)}},cancel:function(u,h){u&&u.upload&&(u.upload.status='cancelled',delete u.upload.chunk,u.upload.$ajax?u.upload.$ajax.abort():null,delete u.upload.$ajax,h?null:f.files.remove(u))},retry:function(u){u&&u.upload&&(u.html&&n.thumbnails._selectors.retry&&u.html.find(n.thumbnails._selectors.retry).remove(),f.upload.prepare(u,!0))},progressHandling:function(u,h,v,w){if(!u&&w&&h.upload.$ajax&&(u={total:h.upload.$ajax.total,loaded:h.upload.$ajax.total,lengthComputable:!0}),u.lengthComputable){var _=u.loaded+(h.upload.chunk?h.upload.chunk.loaded:0),F=h.upload.chunk?h.upload.chunk.size:u.total,I=Math.round(100*_/F),D=h.upload.chunk&&h.upload.chunk.xhrStartedAt?h.upload.chunk.xhrStartedAt:v,C=(new Date().getTime()-D.getTime())/1e3,L=C?_/C:0,S=Math.max(0,F-_),E=Math.max(0,C?S/L:0),T={loaded:_,loadedInFormat:f._assets.bytesToText(_),total:F,totalInFormat:f._assets.bytesToText(F),percentage:I,secondsElapsed:C,secondsElapsedInFormat:f._assets.secondsToText(C,!0),bytesPerSecond:L,bytesPerSecondInFormat:f._assets.bytesToText(L)+'/s',remainingBytes:S,remainingBytesInFormat:f._assets.bytesToText(S),secondsRemaining:E,secondsRemainingInFormat:f._assets.secondsToText(E,!0)};h.upload.chunk&&(h.upload.chunk.isFirst&&(h.upload.chunk.xhrStartedAt=v),u.loaded==u.total&&!h.upload.chunk.isLast&&(h.upload.chunk.loaded+=Math.max(u.total,h.upload.chunk.total/h.upload.chunk.chunkSize))),99<T.percentage&&!w&&(T.percentage=99),n.upload.onProgress&&$.isFunction(n.upload.onProgress)?n.upload.onProgress(T,h,l,p,o,s):null}}},dragDrop:{onDragEnter:function(u){clearTimeout(f.dragDrop._timer),n.dragDrop.container.addClass('fileuploader-dragging'),f.set('feedback',f._assets.textParse(n.captions.drop)),null!=n.dragDrop.onDragEnter&&$.isFunction(n.dragDrop.onDragEnter)?n.dragDrop.onDragEnter(u,l,p,o,s):null},onDragLeave:function(u){clearTimeout(f.dragDrop._timer),f.dragDrop._timer=setTimeout(function(h){return!!f.dragDrop._dragLeaveCheck(h)&&void(n.dragDrop.container.removeClass('fileuploader-dragging'),f.set('feedback',null),null!=n.dragDrop.onDragLeave&&$.isFunction(n.dragDrop.onDragLeave)?n.dragDrop.onDragLeave(h,l,p,o,s):null)},100,u)},onDrop:function(u){clearTimeout(f.dragDrop._timer),n.dragDrop.container.removeClass('fileuploader-dragging'),f.set('feedback',null),u&&u.originalEvent&&u.originalEvent.dataTransfer&&u.originalEvent.dataTransfer.files&&u.originalEvent.dataTransfer.files.length&&(f.isUploadMode()?f.onChange(u,u.originalEvent.dataTransfer.files):s.prop('files',u.originalEvent.dataTransfer.files)),null!=n.dragDrop.onDrop&&$.isFunction(n.dragDrop.onDrop)?n.dragDrop.onDrop(u,l,p,o,s):null},_dragLeaveCheck:function(u){var v,h=$(u.currentTarget);return!h.is(n.dragDrop.container)&&(v=n.dragDrop.container.find(h),v.length)?!1:!0}},clipboard:{paste:function(u){if(f._assets.isIntoView(o)&&u.originalEvent.clipboardData&&u.originalEvent.clipboardData.items&&u.originalEvent.clipboardData.items.length){var h=u.originalEvent.clipboardData.items;f.clipboard.clean();for(var v=0;v<h.length;v++)if(-1!==h[v].type.indexOf('image')||-1!==h[v].type.indexOf('text/uri-list')){var w=h[v].getAsFile(),_=1<n.clipboardPaste?n.clipboardPaste:2e3;w&&(w._name=f._assets.generateFileName(-1==w.type.indexOf('/')?'png':w.type.split('/')[1].toString().toLowerCase(),'Clipboard '),f.set('feedback',f._assets.textParse(n.captions.paste,{ms:_/1e3})),f.clipboard._timer=setTimeout(function(){f.set('feedback',null),f.onChange(u,[w])},_-2))}}},clean:function(){f.clipboard._timer&&(clearTimeout(f.clipboard._timer),delete f.clipboard._timer,f.set('feedback',null))}},files:{add:function(u,h){var T,O,v=u._name||u.name,w=u.size,_=f._assets.bytesToText(w),F=u.type,I=F?F.split('/',1).toString().toLowerCase():'',D=-1==v.indexOf('.')?'':v.split('.').pop().toLowerCase(),C=v.substr(0,v.length-(-1==v.indexOf('.')?D.length:D.length+1)),L=u.data||{},S=u.file||u,E='updated'==h?u.id:Date.now(),L={name:v,title:C,size:w,size2:_,type:F,format:I,extension:D,data:L,file:S,reader:{read:function(z,P,R){return f.files.read(O,z,P,R)}},id:E,input:'choosed'==h?s:null,html:null,choosed:'choosed'==h,appended:'appended'==h||'updated'==h,uploaded:'uploaded'==h};return'updated'==h?(T=f._itFl.indexOf(u),f._itFl[T]=O=L):(f._itFl.push(L),T=f._itFl.length-1,O=f._itFl[T]),O.remove=function(){f.files.remove(O)},n.editor&&'image'==I&&(O.editor={rotate:function(z){f.editor.rotate(O,z)},cropper:function(z){f.editor.crop(O,z)},save:function(z,P,R,A){f.editor.save(O,P,R,z,A)}}),T},read:function(u,h,v,w,_){if(f.isFileReaderSupported()&&!u.data.readerSkip){var F=new FileReader,I=window.URL||window.webkitURL,D=_&&u.data.thumbnail,C='string'!=typeof u.file,L=function(){var O=u.reader._callbacks||[];u.reader._timer&&(clearTimeout(u.reader._timer),delete u.reader._timer),delete u.reader._callbacks,delete u.reader._FileReader;for(var z=0;z<O.length;z++)$.isFunction(O[z])?O[z](u,l,p,o,s):null;n.onFileRead&&$.isFunction(n.onFileRead)?n.onFileRead(u,l,p,o,s):null};if((u.reader.src||u.reader._FileReader)&&!w||(u.reader={_FileReader:F,_callbacks:[],read:u.reader.read}),u.reader.src&&!w)return h&&$.isFunction(h)?h(u,l,p,o,s):null;if(h&&u.reader._callbacks&&(u.reader._callbacks.push(h),1<u.reader._callbacks.length))return;if('astext'==u.format)F.onload=function(O){var z=document.createElement('div');u.reader.node=z,u.reader.src=O.target.result,u.reader.length=O.target.result.length,z.innerHTML=u.reader.src.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'),L()},F.onerror=function(){L(),u.reader={read:u.reader.read}},C?F.readAsText(u.file):$.ajax({url:u.file,success:function(O){F.onload({target:{result:O}})},error:function(){F.onerror()}});else if('image'==u.format||D){var S;F.onload=function(O){var z=new Image,P=function(){u.data&&u.data.readerCrossOrigin&&z.setAttribute('crossOrigin',u.data.readerCrossOrigin),z.src=O.target.result+(w&&!C&&-1==O.target.result.indexOf('data:image')?(-1==O.target.result.indexOf('?')?'?':'&')+'d='+Date.now():''),z.onload=function(){if(u.reader.exifOrientation){var R=document.createElement('canvas'),A=R.getContext('2d'),U=z,H=u.reader.exifOrientation,M=[0,180];R.width=U.naturalWidth,R.height=U.naturalHeight,A.drawImage(U,0,0),R.width=-1<M.indexOf(H)?U.naturalWidth:U.naturalHeight,R.height=-1<M.indexOf(H)?U.naturalHeight:U.naturalWidth;var B=H*Math.PI/180,W=0.5*R.width,Y=0.5*R.height;return A.clearRect(0,0,R.width,R.height),A.translate(W,Y),A.rotate(B),A.translate(0.5*-U.naturalWidth,0.5*-U.naturalHeight),A.drawImage(U,0,0),A.setTransform(1,0,0,1,0,0),z.src=R.toDataURL(u.type,1),void delete u.reader.exifOrientation}u.reader.node=z,u.reader.src=z.src,u.reader.width=z.width,u.reader.height=z.height,u.reader.ratio=f._assets.pxToRatio(u.reader.width,u.reader.height),S&&I.revokeObjectURL(S),L(),D&&(u.reader={read:u.reader.read})},z.onerror=function(){L(),u.reader={read:u.reader.read}}};n.thumbnails.exif&&u.choosed?f._assets.getExifOrientation(u.file,function(R){R&&(u.reader.exifOrientation=R),P()}):P()},F.onerror=function(){L(),u.reader={read:u.reader.read}},C?n.thumbnails.useObjectUrl&&n.thumbnails.canvasImage&&I?F.onload({target:{result:S=I.createObjectURL(u.file)}}):F.readAsDataURL(u.file):F.onload({target:{result:D?u.data.thumbnail:u.file}})}else if('video'==u.format||'audio'==u.format){var S,E=document.createElement(u.format),T=E.canPlayType(u.type);if(F.onerror=function(){u.reader.node=null,L(),u.reader={read:u.reader.read}},I&&''!==T){if(_&&!n.thumbnails.videoThumbnail)return u.reader.node=E,L(),void(u.reader={read:u.reader.read});S=C?I.createObjectURL(u.file):u.file,E.onloadedmetadata=function(){u.reader.node=E,u.reader.src=E.src,u.reader.duration=E.duration,u.reader.duration2=f._assets.secondsToText(E.duration),'video'==u.format&&(u.reader.width=E.videoWidth,u.reader.height=E.videoHeight,u.reader.ratio=f._assets.pxToRatio(u.reader.width,u.reader.height))},E.onerror=function(){L(),u.reader={read:u.reader.read}},E.onloadeddata=function(){if('video'==u.format){var O=document.createElement('canvas'),z=O.getContext('2d');O.width=E.videoWidth,O.height=E.videoHeight,z.drawImage(E,0,0,O.width,O.height),u.reader.frame=f._assets.isBlankCanvas(O)?null:O.toDataURL(),O=z=null}L()},setTimeout(function(){u.data&&u.data.readerCrossOrigin&&E.setAttribute('crossOrigin',u.data.readerCrossOrigin),E.src=S},100)}else F.onerror()}else F.onload=function(O){u.reader.src=O.target.result,u.reader.length=O.target.result.length,L()},F.onerror=function(){L(),u.reader={read:u.reader.read}},C?F[v||'readAsBinaryString'](u.file):L();u.reader._timer=setTimeout(F.onerror,_?n.reader.thumbnailTimeout:n.reader.timeout)}else h&&h(u,l,p,o,s);return null},list:function(u,h,v,w){var _=[];return!n.sorter||v||w&&'ignoreSorter'==w||f.sorter.save(!0),$.each(f._itFl,function(F,I){if(I.upload&&!I.uploaded)return!0;var D=I;if((h||u)&&(D=(D.choosed?'0:/':'')+(h&&null!==f.files.getItemAttr(I,h)?f.files.getItemAttr(I,h):I['string'==typeof I.file?'file':'name'])),u&&(D={file:D},I.editor&&(I.editor.crop||I.editor.rotation)&&(D.editor={},I.editor.rotation&&(D.editor.rotation=I.editor.rotation),I.editor.crop&&(D.editor.crop=I.editor.crop)),'undefined'!=typeof I.index&&(D.index=I.index),I.data&&I.data.listProps))for(var C in I.data.listProps)D[C]=I.data.listProps[C];_.push(D)}),_=n.onListInput&&$.isFunction(n.onListInput)?n.onListInput(_,f._itFl,n.listInput,l,p,o,s):_,u?JSON.stringify(_):_},check:function(u,h,v){var w=['warning',null,!1,!1];if(null!=n.limit&&v&&h.length+f._itFl.length-1>n.limit)return w[1]=f._assets.textParse(n.captions.errors.filesLimit),w[3]=!0,w;if(null!=n.maxSize&&v){var _=0;if($.each(f._itFl,function(I,D){_+=D.size}),_-=u.size,$.each(h,function(I,D){_+=D.size}),_>Math.round(1e6*n.maxSize))return w[1]=f._assets.textParse(n.captions.errors.filesSizeAll),w[3]=!0,w}if(null!=n.onFilesCheck&&$.isFunction(n.onFilesCheck)&&v){var F=n.onFilesCheck(h,n,l,p,o,s);if(!1===F)return w[3]=!0,w}if(null!=n.extensions&&-1==$.inArray(u.extension,n.extensions)&&-1==$.inArray(u.type,n.extensions))return w[1]=f._assets.textParse(n.captions.errors.filesType,u),w;if(null!=n.fileMaxSize&&u.size>1e6*n.fileMaxSize)return w[1]=f._assets.textParse(n.captions.errors.fileSize,u),w;if(4096==u.size&&''==u.type)return w[1]=f._assets.textParse(n.captions.errors.folderUpload,u),w;if(!n.skipFileNameCheck){var _=!1;if($.each(f._itFl,function(I,D){if(D!=u&&!0==D.choosed&&D.file&&D.name==u.name)return _=!0,D.file.size==u.size&&D.file.type==u.type&&(u.file.lastModified&&D.file.lastModified?D.file.lastModified==u.file.lastModified:!0)&&1<h.length?w[2]=!0:(w[1]=f._assets.textParse(n.captions.errors.fileName,u),w[2]=!1),!1}),_)return w}return!0},append:function(u){if(u=$.isArray(u)?u:[u],u.length){for(var h,v=0;v<u.length;v++)h=f._itFl[f.files.add(u[v],'appended')],n.thumbnails?f.thumbnails.item(h):null;return f.set('feedback',null),f.set('listInput',null),n.afterSelect&&$.isFunction(n.afterSelect)?n.afterSelect(l,p,o,s):null,1!=u.length||h}},update:function(u,h){if(!(-1==f._itFl.indexOf(u)||u.upload&&u.upload.$ajax)){var v=u,w=f.files.add($.extend(u,h),'updated'),u=f._itFl[w];u.popup&&u.popup.close&&u.popup.close(),n.thumbnails&&v.html&&f.thumbnails.item(u,v.html),f.set('listInput',null)}},find:function(u){var h=null;return $.each(f._itFl,function(v,w){if(w.html&&w.html.is(u))return h=w,!1}),h},remove:function(u,h){if(!(!h&&n.onRemove&&$.isFunction(n.onRemove)&&!1===n.onRemove(u,l,p,o,s))){if(u.html&&(n.thumbnails.onItemRemove&&$.isFunction(n.thumbnails.onItemRemove)&&!h?n.thumbnails.onItemRemove(u.html,l,p,o,s):u.html.remove()),u.upload&&u.upload.$ajax&&u.upload.cancel&&u.upload.cancel(!0),u.popup&&u.popup.close&&u.popup.close(),u.reader.src&&(u.reader.node=null,URL.revokeObjectURL(u.reader.src)),u.input){var v=!0;$.each(f._itFl,function(w,_){if(u!=_&&(u.input==_.input||h&&1<u.input.get(0).files.length))return v=!1,!1}),v&&(f.isAddMoreMode()&&1<sl.length?(f.set('nextInput'),sl.splice(sl.indexOf(u.input),1),u.input.remove()):f.set('input',''))}-1<f._pfrL.indexOf(u)?f._pfrL.splice(f._pfrL.indexOf(u),1):null,-1<f._pfuL.indexOf(u)?f._pfuL.splice(f._pfuL.indexOf(u),1):null,-1<f._itFl.indexOf(u)?f._itFl.splice(f._itFl.indexOf(u),1):null,u=null,0==f._itFl.length?f.reset():null,f.set('feedback',null),f.set('listInput',null)}},getItemAttr:function(u,h){var v=null;return u&&('undefined'==typeof u[h]?u.data&&'undefined'!=typeof u.data[h]&&(v=u.data[h]):v=u[h]),v},clear:function(u){for(var v,h=0;h<f._itFl.length;){if(v=f._itFl[h],!u&&v.appended){h++;continue}v.html&&(v.html?f._itFl[h].html.remove():null),v.upload&&v.upload.$ajax&&f.upload.cancel(v),f._itFl.splice(h,1)}f.set('feedback',null),f.set('listInput',null),0==f._itFl.length&&n.onEmpty&&$.isFunction(n.onEmpty)?n.onEmpty(l,p,o,s):null}},reset:function(u){u&&(f.clipboard._timer&&f.clipboard.clean(),$.each(sl,function(h,v){h<sl.length&&v.remove()}),sl=[],f.set('input','')),f._itRl=[],f._pfuL=[],f._pfrL=[],f.files.clear(u)},destroy:function(){f.reset(!0),f.bindUnbindEvents(!1),s.removeAttr('style'),p.before(s),delete s.get(0).FileUploader,p.remove(),p=o=l=null},_assets:{bytesToText:function(u){if(0==u)return'0 Byte';var h=1e3,w=Math.floor(Math.log(u)/Math.log(h));return(u/Math.pow(h,w)).toPrecision(3)+' '+['Bytes','KB','MB','GB','TB','PB','EB','ZB','YB'][w]},secondsToText:function(u,h){u=parseInt(Math.round(u),10);var v=Math.floor(u/3600),w=Math.floor((u-3600*v)/60),u=u-3600*v-60*w,_='';return(0<v||!h)&&(_+=(10>v?'0':'')+v+(h?'h ':':')),(0<w||!h)&&(_+=(10>w&&!h?'0':'')+w+(h?'m ':':')),_+=(10>u&&!h?'0':'')+u+(h?'s':''),_},pxToRatio:function(u,h){var v=function(_,F){return 0==F?_:v(F,_%F)},w=v(u,h);return[u/w,h/w]},ratioToPx:function(u,h,v){if(v=(v+'').split(':'),2>v.length)return null;var w=h/v[1]*v[0],_=u/v[0]*v[1];return[w,_,v[0],v[1]]},hasAttr:function(u,h){var h=h?h:s,v=h.attr(u);return v&&'undefined'!=typeof v},copyAllAttributes:function(u,h){return $.each(h.get(0).attributes,function(){'required'==this.name||'type'==this.name||u.attr(this.name,this.value)}),h.get(0).FileUploader&&(u.get(0).FileUploader=h.get(0).FileUploader),u},getAllEvents:function(u){var u=u?u:s,h=[];for(var v in u=u.get?u.get(0):u,u)0===v.indexOf('on')&&h.push(v.slice(2));return-1==h.indexOf('change')&&h.push('change'),h.join(' ')},isIntoView:function(u){var h=$(window).scrollTop(),v=h+window.innerHeight,w=u.offset().top,_=w+u.outerHeight();return h<w&&v>_},isBlankCanvas:function(u){var h=document.createElement('canvas'),v=!1;h.width=u.width,h.height=u.height;try{v=u.toDataURL()==h.toDataURL()}catch(w){}return h=null,v},generateFileName:function(u,h){var v=new Date,w=function(_){return 10>_&&(_='0'+_),_},h=h?h:'',u=u?'.'+u:'';return h+v.getFullYear()+'-'+w(v.getMonth()+1)+'-'+w(v.getDate())+' '+w(v.getHours())+'-'+w(v.getMinutes())+'-'+w(v.getSeconds())+u},arrayBufferToBase64:function(u){for(var h='',v=new Uint8Array(u),w=0;w<v.byteLength;w++)h+=String.fromCharCode(v[w]);return window.btoa(h)},dataURItoBlob:function(u,h){for(var v=atob(u.split(',')[1]),w=u.split(',')[0].split(':')[1].split(';')[0],_=new ArrayBuffer(v.length),F=new Uint8Array(_),I=0;I<v.length;I++)F[I]=v.charCodeAt(I);var D=new DataView(_),C=new Blob([D.buffer],{type:h||w});return C},getExifOrientation:function(u,h){var v=new FileReader,w={1:0,3:180,6:90,8:270};v.onload=function(_){var F=new DataView(_.target.result),I=1;if(65496==F.getUint16(0,!1))for(var L,D=F.byteLength,C=2;C<D&&!(8>=F.getUint16(C+2,!1));)if(L=F.getUint16(C,!1),C+=2,65505==L){if(1165519206!=F.getUint32(C+=2,!1))break;var E,S=18761==F.getUint16(C+=6,!1);C+=F.getUint32(C+4,S),E=F.getUint16(C,S),C+=2;for(var T=0;T<E;T++)if(274==F.getUint16(C+12*T,S)){I=F.getUint16(C+12*T+8,S),D=0;break}}else if(65280!=(65280&L))break;else C+=F.getUint16(C,!1);h?h(w[I]||0):null},v.onerror=function(){h?h(''):null},v.readAsArrayBuffer(u)},textParse:function(text,opts,noOptions){switch(opts=noOptions?opts||{}:$.extend({},{limit:n.limit,maxSize:n.maxSize,fileMaxSize:n.fileMaxSize,extensions:n.extensions?n.extensions.join(', '):null,captions:n.captions},opts),typeof text){case'string':text=text.replace(/\$\{(.*?)\}/g,function(match,a){var a=a.replace(/ /g,''),r='undefined'!=typeof opts[a]&&null!=opts[a]?opts[a]:'';if(-1<a.indexOf('.')||-1<a.indexOf('[]')){var x=a.substr(0,-1<a.indexOf('.')?a.indexOf('.'):-1<a.indexOf('[')?a.indexOf('['):a.length),y=a.substring(x.length);if(opts[x])try{r=eval('opts["'+x+'"]'+y)}catch(u){r=''}}return r=$.isFunction(r)?f._assets.textParse(r):r,r||''});break;case'function':text=f._assets.textParse(text(opts,l,p,o,s,f._assets.textParse),opts,noOptions);}return opts=null,text},textToColor:function(u){if(!u||0==u.length)return!1;for(var h=0,v=0;h<u.length;v=u.charCodeAt(h++)+((v<<5)-v));for(var h=0,w='#';3>h;w+=('00'+(255&v>>2*h++).toString(16)).slice(-2));return w},isBrightColor:function(u){var h=function(w){var _;return w&&w.constructor==Array&&3==w.length?w:(_=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(w))?[parseInt(_[1]),parseInt(_[2]),parseInt(_[3])]:(_=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(w))?[2.55*parseFloat(_[1]),2.55*parseFloat(_[2]),2.55*parseFloat(_[3])]:(_=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(w))?[parseInt(_[1],16),parseInt(_[2],16),parseInt(_[3],16)]:(_=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(w))?[parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16)]:'undefined'==typeof colors?null:colors[$.trim(w).toLowerCase()]};return 194<function(w){var _=h(w);return _?0.2126*_[0]+0.7152*_[1]+0.0722*_[2]:null}(u)}},isSupported:function(){return s&&s.get(0).files},isFileReaderSupported:function(){return window.File&&window.FileList&&window.FileReader},isDefaultMode:function(){return!n.upload&&(!n.addMore||n.limit==1)},isAddMoreMode:function(){return!n.upload&&n.addMore&&1!=n.limit},isUploadMode:function(){return n.upload},_itFl:[],_pfuL:[],_pfrL:[],disabled:!1,locked:!1,rendered:!1};return n.enableApi&&(s.get(0).FileUploader={open:function(){s.trigger('click')},getOptions:function(){return n},getParentEl:function(){return p},getInputEl:function(){return s},getNewInputEl:function(){return o},getListEl:function(){return l},getListInputEl:function(){return n.listInput},getFiles:function(){return f._itFl},getChoosedFiles:function(){return f._itFl.filter(function(u){return u.choosed})},getAppendedFiles:function(){return f._itFl.filter(function(u){return u.appended})},getUploadedFiles:function(){return f._itFl.filter(function(u){return u.uploaded})},getFileList:function(u,h){return f.files.list(u,h,!0)},updateFileList:function(){return f.set('listInput',null),!0},setOption:function(u,h){return n[u]=h,!0},findFile:function(u){return f.files.find(u)},add:function(u,h,v){if(!f.isUploadMode())return!1;var w;if(u instanceof Blob)w=u;else{var _=/data:[a-z]+\/[a-z]+\;base64\,/.test(u)?u:'data:'+h+';base64,'+btoa(u);w=f._assets.dataURItoBlob(_,h)}return w._name=v||f._assets.generateFileName(-1==w.type.indexOf('/')?'File ':w.type.split('/')[1].toString().toLowerCase()),f.onChange(null,[w]),!0},append:function(u){return f.files.append(u)},update:function(u,h){return f.files.update(u,h)},remove:function(u){return u=u.jquery?f.files.find(u):u,!!(-1<f._itFl.indexOf(u))&&(f.files.remove(u),!0)},uploadStart:function(){var u=this.getChoosedFiles()||[];if(f.isUploadMode()&&0<u.length&&!u[0].uploaded)for(var h=0;h<u.length;h++)f.upload.send(u[h])},reset:function(){return f.reset(!0),!0},disable:function(u){return f.set('disabled',!0),u&&(f.locked=!0),!0},enable:function(){return f.set('disabled',!1),f.locked=!1,!0},destroy:function(){return f.destroy(),!0},isEmpty:function(){return 0==f._itFl.length},isDisabled:function(){return f.disabled},isRendered:function(){return f.rendered},assets:f._assets,getPluginMode:function(){return f.isDefaultMode()?'default':f.isAddMoreMode()?'addMore':f.isUploadMode()?'upload':void 0}}),f.init(),this})},$.fileuploader={getInstance:function(u){var h=u.prop?u:$(u);return h.get(0).FileUploader}},$.fn.fileuploader.defaults={limit:null,maxSize:null,fileMaxSize:null,extensions:null,changeInput:!0,inputNameBrackets:!0,theme:'default',thumbnails:{box:'<div class="fileuploader-items"><ul class="fileuploader-items-list"></ul></div>',boxAppendTo:null,item:'<li class="fileuploader-item file-has-popup"><div class="columns"><div class="column-thumbnail">${image}<span class="fileuploader-action-popup"></span></div><div class="column-title"><div title="${name}">${name}</div><span>${size2}</span></div><div class="column-actions"><a class="fileuploader-action fileuploader-action-remove" title="${captions.remove}"><i></i></a></div></div><div class="progress-bar2">${progressBar}<span></span></div></li>',item2:'<li class="fileuploader-item file-has-popup"><div class="columns"><div class="column-thumbnail">${image}<span class="fileuploader-action-popup"></span></div><div class="column-title"><a href="${file}" target="_blank"><div title="${name}">${name}</div><span>${size2}</span></a></div><div class="column-actions"><a href="${file}" class="fileuploader-action fileuploader-action-download" title="${captions.download}" download><i></i></a><a class="fileuploader-action fileuploader-action-remove" title="${captions.remove}"><i></i></a></div></div></li>',popup:{container:'body',loop:!0,arrows:!0,template:function(u){return'<div class="fileuploader-popup-preview"><a class="fileuploader-popup-move" data-action="prev"></a><div class="fileuploader-popup-node ${format}">${reader.node}</div><div class="fileuploader-popup-content"><ul class="fileuploader-popup-meta"><li><span>${captions.name}:</span><h5>${name}</h5></li><li><span>${captions.type}:</span><h5>${extension.toUpperCase()}</h5></li><li><span>${captions.size}:</span><h5>${size2}</h5></li>'+(u.reader&&u.reader.width?'<li><span>${captions.dimensions}:</span><h5>${reader.width}x${reader.height}px</h5></li>':'')+(u.reader&&u.reader.duration?'<li><span>${captions.duration}:</span><h5>${reader.duration2}</h5></li>':'')+'</ul><ul class="fileuploader-popup-tools">'+('image'==u.format&&u.editor?(u.editor.cropper?'<li><a data-action="crop"><i></i><span>${captions.crop}</span></a></li>':'')+(u.editor.rotate?'<li><a data-action="rotate-cw"><i></i><span>${captions.rotate}</span></a></li>':''):'')+'<li><a data-action="remove"><i></i><span>${captions.remove}</span></a></li></ul><div class="fileuploader-popup-buttons"><a class="fileuploader-popup-button" data-action="cancel">${captions.cancel}</a><a class="fileuploader-popup-button button-success" data-action="save">${captions.confirm}</a></div></div><a class="fileuploader-popup-move" data-action="next"></a></div>'},onShow:function(u){u.popup.html.on('click','[data-action="prev"]',function(){u.popup.move('prev')}).on('click','[data-action="next"]',function(){u.popup.move('next')}).on('click','[data-action="crop"]',function(){u.editor&&u.editor.cropper()}).on('click','[data-action="rotate-cw"]',function(){u.editor&&u.editor.rotate()}).on('click','[data-action="remove"]',function(){u.popup.close(),u.remove()}).on('click','[data-action="cancel"]',function(){u.popup.close()}).on('click','[data-action="save"]',function(){u.editor&&u.editor.save(),u.popup.close&&u.popup.close()})},onHide:null},itemPrepend:!1,removeConfirmation:!0,startImageRenderer:!0,synchronImages:!0,useObjectUrl:!1,canvasImage:!0,videoThumbnail:!1,exif:!0,_selectors:{list:'.fileuploader-items-list',item:'.fileuploader-item',start:'.fileuploader-action-start',retry:'.fileuploader-action-retry',remove:'.fileuploader-action-remove',sorter:'.fileuploader-action-sort',popup:'.fileuploader-popup-preview',popup_open:'.fileuploader-action-popup'},beforeShow:null,onItemShow:null,onItemRemove:function(u){u.children().animate({opacity:0},200,function(){setTimeout(function(){u.slideUp(200,function(){u.remove()})},100)})},onImageLoaded:null},editor:!1,sorter:!1,reader:{thumbnailTimeout:5e3,timeout:12000},files:null,upload:null,dragDrop:!0,addMore:!1,skipFileNameCheck:!1,clipboardPaste:!0,listInput:!0,enableApi:!1,listeners:null,onSupportError:null,beforeRender:null,afterRender:null,beforeSelect:null,onFilesCheck:null,onFileRead:null,onSelect:null,afterSelect:null,onListInput:null,onRemove:null,onEmpty:null,dialogs:{alert:function(u){return alert(u)},confirm:function(u,h){confirm(u)?h():null}},captions:{button:function(u){return'Choose '+(1==u.limit?'File':'Files')},feedback:function(u){return'Choose '+(1==u.limit?'file':'files')+' to upload'},feedback2:function(u){return u.length+' '+(1<u.length?' files were':' file was')+' chosen'},confirm:'Confirm',cancel:'Cancel',name:'Name',type:'Type',size:'Size',dimensions:'Dimensions',duration:'Duration',crop:'Crop',rotate:'Rotate',sort:'Sort',download:'Download',remove:'Remove',drop:'Drop the files here to Upload',paste:'<div class="fileuploader-pending-loader"></div> Pasting a file, click here to cancel.',removeConfirmation:'Are you sure you want to remove this file?',errors:{filesLimit:'Only ${limit} files are allowed to be uploaded.',filesType:'Only ${extensions} files are allowed to be uploaded.',fileSize:'${name} is too large! Please choose a file up to ${fileMaxSize}MB.',filesSizeAll:'Files that you chose are too large! Please upload files up to ${maxSize} MB.',fileName:'File with the name ${name} is already selected.',folderUpload:'You are not allowed to upload folders.'}}}})(jQuery);